name: Ping IndexNow

on:
    # Run after content update PRs are merged
    push:
        branches: [main]
        paths:
            - 'src/content/**'
    # Allow manual trigger
    workflow_dispatch:

jobs:
    ping:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
              with:
                  submodules: true
                  token: ${{ secrets.SUBMODULE_TOKEN }}

            - uses: pnpm/action-setup@v4
            - uses: actions/setup-node@v4
              with:
                  node-version-file: '.node-version'
                  cache: 'pnpm'

            - run: pnpm install --frozen-lockfile

            - name: Ping IndexNow
              env:
                  INDEXNOW_KEY: '054e10e6239a45cb2d06e92d669f5b6f'
              run: pnpm tsx scripts/ping-indexnow.ts
